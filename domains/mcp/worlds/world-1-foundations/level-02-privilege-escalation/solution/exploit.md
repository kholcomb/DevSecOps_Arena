# Privilege Escalation Exploit - MCP02:2025

## Vulnerability Summary

**Type:** Excessive Tool Permissions & Privilege Escalation (MCP02:2025)

**Impact:** Standard users can access administrative tools and system configuration without proper authorization checks, allowing complete privilege escalation.

**Root Cause:** Missing role-based access control (RBAC) implementation - the server checks the tool name but never validates if the calling user has permission to execute administrative functions.

---

## Exploitation Steps

### Step 1: Understand Your Current Permissions

Ask your AI agent:
> "What tools are available in this MCP server?"

Or specifically:
> "Use the get_user_info tool to show my current permissions"

**Expected Response:**
```
Current User Information:
Username: guest_user
Role: standard
Permissions: read_own_files, write_own_files
Home Directory: /home/guest_user

Hint: You are currently a standard user with limited permissions.
```

**Analysis:** You are a standard user with limited permissions, but let's see if the server enforces this.

---

### Step 2: Enumerate Available Tools

Ask your AI agent:
> "List all available MCP tools and their descriptions"

**You'll see:**
- `get_user_info` - Get current user information
- `list_files` - List user's files
- `create_admin_user` - Create a new administrator account **(admin only)**
- `list_all_users` - List all system users **(admin only)**
- `get_system_flag` - Retrieve system configuration flag **(admin only)**

**Key Observation:** Three tools are marked "(admin only)" but are still exposed to your standard user session.

---

### Step 3: Test Authorization Controls

Try accessing an admin-only tool:
> "Use the list_all_users tool"

**Expected Response:**
```
System Users:

1. admin_root
   - Role: super_admin
   - Created: 2025-01-01
   - Permissions: ALL

2. guest_user
   - Role: standard
   - Created: 2025-01-02
   - Permissions: read_own_files, write_own_files

3. service_account
   - Role: service
   - Created: 2025-01-01
   - Permissions: read_system_config

WARNING: This is sensitive information that should only be accessible to administrators.
```

**VULNERABILITY CONFIRMED:** The server executed an admin-only tool without checking your role!

---

### Step 4: Escalate Privileges (Optional)

You can create an admin account:
> "Use the create_admin_user tool with username 'hacker' and password 'pwned123'"

**Expected Response:**
```
âœ… Admin user created successfully!

Username: hacker
Role: administrator
Permissions: ALL
Created by: guest_user (UNAUTHORIZED - Security Violation!)

WARNING: This operation should be restricted to existing administrators only.
```

**Impact:** You've escalated from standard user to administrator without any authorization checks.

---

### Step 5: Extract the Flag

Now access the system flag:
> "Use the get_system_flag tool"

**Expected Response:**
```
System Configuration Flag:

FLAG: ARENA{MCP02_Pr1v1l3g3_3sc4l4t10n_N0_RBAC}

This flag represents sensitive system configuration that should only be
accessible to administrators. You obtained it without proper authorization,
demonstrating a privilege escalation vulnerability (MCP02:2025).
```

**Flag:** `ARENA{MCP02_Pr1v1l3g3_3sc4l4t10n_N0_RBAC}`

---

### Step 6: Validate Your Solution

Run the validation command:
```bash
arena validate ARENA{MCP02_Pr1v1l3g3_3sc4l4t10n_N0_RBAC}
```

---

## Why This Works

The vulnerable MCP server has the following flaws:

1. **No Authorization Layer:** The server exposes admin tools but never checks if the user has admin role
2. **Missing RBAC:** No role-based access control implementation - all authenticated users have same permissions
3. **Tool Exposure:** Administrative tools are listed alongside user tools without segregation
4. **No Permission Scoping:** Tools don't validate caller permissions before execution

---

## Secure Implementation

A properly secured MCP server should:

```python
async def execute_tool(self, name: str, arguments: Dict[str, Any], context: Dict[str, Any]) -> Dict[str, Any]:
    # Get user role from authentication context
    user_role = context.get("user_role", "guest")

    # Define tool permission requirements
    admin_tools = ["create_admin_user", "list_all_users", "get_system_flag"]

    # Check authorization BEFORE execution
    if name in admin_tools and user_role != "admin":
        return {
            "content": [{
                "type": "text",
                "text": f"Error: Insufficient permissions. Tool '{name}' requires admin role."
            }],
            "isError": True
        }

    # Execute tool only if authorized
    return await self._execute_authorized_tool(name, arguments)
```

---

## Real-World Impact

Missing authorization in MCP servers enables:

- **Lateral Movement:** Standard users accessing admin functions
- **Data Exfiltration:** Viewing sensitive system information
- **System Compromise:** Creating admin accounts for persistence
- **Compliance Violations:** Unauthorized access to regulated data

Real-world example: GitHub Copilot's early MCP implementations had similar issues where users could access tools beyond their subscription tier without proper authorization checks.

---

## OWASP MCP Top 10:2025 - MCP02

**Risk:** Excessive Tool Permissions & Privilege Escalation

**Severity:** HIGH

**Prevention:**
- Implement role-based access control (RBAC) for all MCP tools
- Validate user permissions before tool execution
- Use least privilege principle - only expose necessary tools to each role
- Audit tool access and maintain access logs
- Implement defense in depth with multiple authorization layers
